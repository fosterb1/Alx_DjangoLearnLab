{% extends 'blog/base.html' %}

{% block title %}{{ post.title }} - Django Blog{% endblock %}

{% block content %}
<div class="post-detail-container">
  <article class="post-detail">
    <div class="post-header">
      <h1 class="post-title">{{ post.title }}</h1>

      <div class="post-meta-detail">
        <div class="author-info">
          <div class="author-avatar">
            <i class="fas fa-user-circle fa-2x"></i>
          </div>
          <div class="author-details">
            <strong>{{ post.author.username }}</strong>
            <span class="post-date"
              >{{ post.published_date|date:"F d, Y • g:i A" }}</span
            >
            {% if post.updated_date != post.published_date %}
            <span class="updated-date"
              >Updated: {{ post.updated_date|date:"F d, Y" }}</span
            >
            {% endif %}
          </div>
        </div>

        {% if user == post.author %}
        <div class="post-actions-detail">
          <a href="{% url 'post_edit' pk=post.pk %}" class="btn btn-secondary">
            <i class="fas fa-edit"></i> Edit
          </a>
          <a href="{% url 'post_delete' pk=post.pk %}" class="btn btn-danger">
            <i class="fas fa-trash"></i> Delete
          </a>
        </div>
        {% endif %}
      </div>
    </div>

    <div class="post-content">{{ post.content|linebreaks }}</div>

    <div class="post-footer">
      <div class="post-tags">
        {% if post.tags.all %}
          {% for tag in post.tags.all %}
          <a href="{% url 'posts_by_tag' tag.name %}" class="tag">
            <i class="fas fa-tag"></i> {{ tag.name }}
          </a>
          {% endfor %}
        {% else %}
          <span class="text-muted">No tags</span>
        {% endif %}
      </div>

      <div class="navigation-buttons">
        <a href="{% url 'post_list' %}" class="btn">
          <i class="fas fa-arrow-left"></i> Back to Posts
        </a>
      </div>
    </div>
  </article>

  <!-- Comments Section -->
  <div class="comments-section">
    <h3><i class="fas fa-comments"></i> Comments ({{ comments.count }})</h3>

    {% if user.is_authenticated %}
    <!-- Add Comment Form -->
    <div class="comment-form-container">
      <h4>Add a Comment</h4>
      <form method="post" action="{% url 'add_comment' post.pk %}">
        {% csrf_token %}
        {{ comment_form.content }}
        {% if comment_form.content.errors %}
        <div class="error-list">
          {% for error in comment_form.content.errors %}
          <span class="error">{{ error }}</span>
          {% endfor %}
        </div>
        {% endif %}
        <button type="submit" class="btn btn-primary">
          <i class="fas fa-paper-plane"></i> Post Comment
        </button>
      </form>
    </div>
    {% else %}
    <p class="login-prompt">
      <a href="{% url 'login' %}">Login</a> to leave a comment.
    </p>
    {% endif %}

    <!-- Display Comments -->
    <div class="comments-list">
      {% for comment in comments %}
      <div class="comment">
        <div class="comment-header">
          <div class="comment-author">
            <i class="fas fa-user-circle"></i>
            <strong>{{ comment.author.username }}</strong>
          </div>
          <div class="comment-meta">
            <span class="comment-date">{{ comment.created_at|date:"F d, Y • g:i A" }}</span>
            {% if comment.created_at != comment.updated_at %}
            <span class="comment-edited">(edited)</span>
            {% endif %}
          </div>
        </div>

        <div class="comment-content">{{ comment.content|linebreaks }}</div>

        {% if user == comment.author %}
        <div class="comment-actions">
          <a href="{% url 'comment_edit' comment.pk %}" class="btn-link">
            <i class="fas fa-edit"></i> Edit
          </a>
          <a href="{% url 'comment_delete' comment.pk %}" class="btn-link text-danger">
            <i class="fas fa-trash"></i> Delete
          </a>
        </div>
        {% endif %}
      </div>
      {% empty %}
      <p class="no-comments">No comments yet. Be the first to comment!</p>
      {% endfor %}
    </div>
  </div>
</div>
{% endblock %}
